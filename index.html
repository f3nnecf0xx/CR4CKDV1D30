<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #0f0f0f;
        color: #fff;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 56px;
        background: #212121;
        display: flex;
        align-items: center;
        padding: 0 16px;
        z-index: 1000;
        border-bottom: 1px solid #303030;
    }

    .logo {
        font-size: 20px;
        font-weight: 600;
        color: #fff;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .logo-icon {
        width: 32px;
        height: 32px;
        background: #f00;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }

    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
    .sidebar {
        position: fixed;
        top: 56px;
        left: 0;
        width: 240px;
        height: calc(100vh - 56px);
        background: #212121;
        overflow-y: auto;
        border-right: 1px solid #303030;
        z-index: 900;
    }

    .sidebar-section {
        padding: 12px 0;
        border-bottom: 1px solid #303030;
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        padding: 10px 24px;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 14px;
        color: #fff;
    }

    .sidebar-item:hover {
        background: #3a3a3a;
    }

    .sidebar-item.active {
        background: #3a3a3a;
        font-weight: 500;
    }

    .sidebar-item-icon {
        width: 24px;
        height: 24px;
        margin-right: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .main {
        margin-left: 240px;
        margin-top: 56px;
        padding: 24px;
    }

    /* ãƒ›ãƒ¼ãƒ ç”»é¢ - ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
        max-width: 1920px;
    }

    .video-card {
        cursor: pointer;
        transition: transform 0.2s;
    }

    .video-card:hover {
        transform: scale(1.02);
    }

    .video-card-thumbnail {
        width: 100%;
        aspect-ratio: 16/9;
        background: #303030;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }

    .video-card-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .video-card-duration {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.8);
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
    }

    .video-card-info {
        padding: 12px 0;
    }

    .video-card-title {
        font-size: 14px;
        font-weight: 500;
        line-height: 1.4;
        margin-bottom: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .video-card-channel {
        font-size: 12px;
        color: #aaa;
        margin-bottom: 2px;
    }

    .video-card-meta {
        font-size: 12px;
        color: #aaa;
    }

    /* å‹•ç”»å†ç”Ÿç”»é¢ */
    .player-container {
        display: none;
        max-width: 1280px;
    }

    .player-container.active {
        display: block;
    }

    .video-player {
        width: 100%;
        aspect-ratio: 16/9;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
    }

    .video-js {
        width: 100%;
        height: 100%;
    }

    .video-details {
        padding: 20px 0;
    }

    .video-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 12px;
        line-height: 1.4;
    }

    .video-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #aaa;
        font-size: 14px;
        margin-bottom: 16px;
    }

    .video-meta span {
        display: flex;
        align-items: center;
    }

    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #3a3a3a;
        border: none;
        border-radius: 18px;
        color: #fff;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        margin-bottom: 16px;
        transition: background 0.2s;
    }

    .back-button:hover {
        background: #4a4a4a;
    }

    /* é–¢é€£å‹•ç”» */
    .related-videos {
        margin-top: 24px;
    }

    .related-videos h3 {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 16px;
    }

    .related-video-item {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: background 0.2s;
    }

    .related-video-item:hover {
        background: #272727;
    }

    .related-video-thumbnail {
        width: 168px;
        height: 94px;
        background: #303030;
        border-radius: 8px;
        flex-shrink: 0;
        overflow: hidden;
        position: relative;
    }

    .related-video-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .related-video-info {
        flex: 1;
    }

    .related-video-title {
        font-size: 14px;
        font-weight: 500;
        line-height: 1.4;
        margin-bottom: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .related-video-meta {
        font-size: 12px;
        color: #aaa;
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #aaa;
    }

    .error {
        text-align: center;
        padding: 40px;
        color: #f00;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 1024px) {
        .video-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s;
        }

        .sidebar.mobile-open {
            transform: translateX(0);
        }

        .main {
            margin-left: 0;
        }

        .video-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .related-video-thumbnail {
            width: 120px;
            height: 68px;
        }
    }
</style>
```

</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <div class="logo" onclick="showHome()">
            <div class="logo-icon">â–¶</div>
            <span>å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</span>
        </div>
    </div>

```
<!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-section">
        <div class="sidebar-item active" onclick="showHome()">
            <div class="sidebar-item-icon">ğŸ </div>
            ãƒ›ãƒ¼ãƒ 
        </div>
    </div>
    <div class="sidebar-section" id="channelList">
        <!-- ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
    </div>
</div>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="main">
    <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
    <div id="homeView">
        <div class="video-grid" id="videoGrid">
            <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>

    <!-- å‹•ç”»å†ç”Ÿç”»é¢ -->
    <div id="playerView" class="player-container">
        <button class="back-button" onclick="showHome()">
            â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
        </button>
        <div class="video-player">
            <video id="videoPlayer" class="video-js vjs-big-play-centered" controls preload="auto"></video>
        </div>
        <div class="video-details">
            <div class="video-title" id="currentVideoTitle"></div>
            <div class="video-meta" id="currentVideoMeta"></div>
        </div>
        <div class="related-videos">
            <h3>é–¢é€£å‹•ç”»</h3>
            <div id="relatedVideos"></div>
        </div>
    </div>
</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
    let player;
    let allVideos = [];
    let displayedVideos = []; // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å‹•ç”»ãƒªã‚¹ãƒˆ
    let channels = {};

    // Video.jsãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸåŒ–
    function initPlayer() {
        player = videojs('videoPlayer', {
            controls: true,
            autoplay: false,
            preload: 'auto',
            fluid: false,
            responsive: true
        });
    }

    // channels.txtã‹ã‚‰ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿
    async function loadChannelList() {
        try {
            const response = await fetch('channels.txt');
            const text = await response.text();
            const channelNames = text.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
            
            for (const channelName of channelNames) {
                channels[channelName] = `${channelName}.json`;
            }
            
            renderChannelList();
            loadAllVideos();
        } catch (error) {
            console.error('Error loading channel list:', error);
            document.getElementById('videoGrid').innerHTML = 
                '<div class="error">ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
        }
    }

    // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
    function renderChannelList() {
        const channelList = document.getElementById('channelList');
        channelList.innerHTML = '';

        Object.keys(channels).forEach(channelName => {
            const item = document.createElement('div');
            item.className = 'sidebar-item';
            item.innerHTML = `
                <div class="sidebar-item-icon">#</div>
                ${channelName}
            `;
            item.onclick = () => filterByChannel(channelName);
            channelList.appendChild(item);
        });
    }

    // ã™ã¹ã¦ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰å‹•ç”»ã‚’èª­ã¿è¾¼ã¿
    async function loadAllVideos() {
        allVideos = [];
        
        for (const [channelName, jsonPath] of Object.entries(channels)) {
            try {
                const response = await fetch(jsonPath);
                const videos = await response.json();
                
                // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å„å‹•ç”»ã«è¿½åŠ 
                videos.forEach(video => {
                    video.channelName = channelName;
                    video.m3u8Url = getM3u8Url(video);
                });
                
                allVideos.push(...videos);
            } catch (error) {
                console.error(`Error loading ${channelName}:`, error);
            }
        }

        renderVideoGrid(allVideos);
    }

    // m3u8 URLã‚’å–å¾—ï¼ˆè¤‡æ•°ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¯¾å¿œï¼‰
    function getM3u8Url(video) {
        // ãƒãƒ£ãƒ³ãƒãƒ«å/å‹•ç”»ID.m3u8 ã®æ§‹é€ 
        if (video.content_code && video.channelName) {
            return `/${video.channelName}/${video.content_code}.m3u8`;
        }
        return video.url || video.m3u8 || '';
    }

    // å‹•ç”»ã®é•·ã•ã‚’ç§’ã‹ã‚‰HH:MM:SSå½¢å¼ã«å¤‰æ›
    function formatDuration(seconds) {
        if (!seconds) return '';
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = Math.floor(seconds % 60);
        
        if (h > 0) {
            return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        return `${m}:${s.toString().padStart(2, '0')}`;
    }

    // æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays === 0) return 'ä»Šæ—¥';
        if (diffDays === 1) return 'æ˜¨æ—¥';
        if (diffDays < 7) return `${diffDays}æ—¥å‰`;
        if (diffDays < 30) return `${Math.floor(diffDays / 7)}é€±é–“å‰`;
        if (diffDays < 365) return `${Math.floor(diffDays / 30)}ãƒ¶æœˆå‰`;
        return `${Math.floor(diffDays / 365)}å¹´å‰`;
    }

    // è¦–è´å›æ•°ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatViews(views) {
        if (!views) return '0å›è¦–è´';
        if (typeof views === 'number') {
            return `${views.toLocaleString()}å›è¦–è´`;
        }
        return `${views}å›è¦–è´`;
    }

    // ãƒ“ãƒ‡ã‚ªã‚°ãƒªãƒƒãƒ‰ã‚’è¡¨ç¤º
    function renderVideoGrid(videos) {
        const grid = document.getElementById('videoGrid');
        
        if (!videos || videos.length === 0) {
            grid.innerHTML = '<div class="error">å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
            displayedVideos = [];
            return;
        }

        // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å‹•ç”»ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        displayedVideos = videos;

        grid.innerHTML = videos.map((video, index) => `
            <div class="video-card" onclick='playVideoFromGrid(${index})'>
                <div class="video-card-thumbnail">
                    ${video.thumbnail_url ? `<img src="${video.thumbnail_url}" alt="${video.title || ''}">` : ''}
                    <div class="video-card-duration">${formatDuration(video.active_video_filename?.length)}</div>
                </div>
                <div class="video-card-info">
                    <div class="video-card-title">${video.title || 'ç„¡é¡Œã®å‹•ç”»'}</div>
                    <div class="video-card-channel">${video.channelName || ''}</div>
                    <div class="video-card-meta">
                        ${formatViews(video.video_aggregate_info?.total_views)} â€¢ ${formatDate(video.display_date || video.released_at)}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // ã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰å‹•ç”»ã‚’å†ç”Ÿ
    function playVideoFromGrid(index) {
        const video = displayedVideos[index];
        showPlayer();
        playVideo(video);
    }

    // å‹•ç”»ã‚’å†ç”Ÿ
    function playVideo(video) {
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚½ãƒ¼ã‚¹ã‚’è¨­å®š
        player.src({
            src: video.m3u8Url,
            type: 'application/x-mpegURL'
        });

        // å‹•ç”»æƒ…å ±ã‚’è¡¨ç¤º
        document.getElementById('currentVideoTitle').textContent = video.title || 'ç„¡é¡Œã®å‹•ç”»';
        document.getElementById('currentVideoMeta').innerHTML = `
            <span>${video.channelName}</span>
            <span>â€¢</span>
            <span>${formatViews(video.video_aggregate_info?.total_views)}</span>
            <span>â€¢</span>
            <span>${formatDate(video.display_date || video.released_at)}</span>
        `;

        // é–¢é€£å‹•ç”»ã‚’è¡¨ç¤ºï¼ˆç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒªã‚¹ãƒˆã‹ã‚‰åŒã˜ãƒãƒ£ãƒ³ãƒãƒ«ã®ä»–ã®å‹•ç”»ï¼‰
        const relatedVideos = displayedVideos
            .filter(v => v.channelName === video.channelName && v.content_code !== video.content_code)
            .slice(0, 10);
        
        renderRelatedVideos(relatedVideos);

        // å†ç”Ÿé–‹å§‹
        player.play().catch(error => {
            console.error('Playback error:', error);
        });
    }

    // é–¢é€£å‹•ç”»ã‚’è¡¨ç¤º
    function renderRelatedVideos(videos) {
        const container = document.getElementById('relatedVideos');
        
        container.innerHTML = videos.map((video, index) => {
            const globalIndex = displayedVideos.findIndex(v => v.content_code === video.content_code);
            return `
                <div class="related-video-item" onclick='playVideoFromGrid(${globalIndex})'>
                    <div class="related-video-thumbnail">
                        ${video.thumbnail_url ? `<img src="${video.thumbnail_url}" alt="${video.title || ''}">` : ''}
                        <div class="video-card-duration">${formatDuration(video.active_video_filename?.length)}</div>
                    </div>
                    <div class="related-video-info">
                        <div class="related-video-title">${video.title || 'ç„¡é¡Œã®å‹•ç”»'}</div>
                        <div class="related-video-meta">
                            ${video.channelName}<br>
                            ${formatViews(video.video_aggregate_info?.total_views)} â€¢ ${formatDate(video.display_date || video.released_at)}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // ãƒãƒ£ãƒ³ãƒãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    function filterByChannel(channelName) {
        const filteredVideos = allVideos.filter(v => v.channelName === channelName);
        renderVideoGrid(filteredVideos);
        
        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
    }

    // ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤º
    function showHome() {
        document.getElementById('homeView').style.display = 'block';
        document.getElementById('playerView').classList.remove('active');
        renderVideoGrid(allVideos);
        
        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ›ãƒ¼ãƒ ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        document.querySelectorAll('.sidebar-item').forEach((item, index) => {
            item.classList.remove('active');
            if (index === 0) {
                item.classList.add('active');
            }
        });
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åœæ­¢
        if (player) {
            player.pause();
        }
    }

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”»é¢ã‚’è¡¨ç¤º
    function showPlayer() {
        document.getElementById('homeView').style.display = 'none';
        document.getElementById('playerView').classList.add('active');
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
        initPlayer();
        loadChannelList();
    });
</script>
```

</body>
</html>