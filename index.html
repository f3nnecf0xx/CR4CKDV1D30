<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂãïÁîª„Éó„É¨„Ç§„É§„Éº</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: #fff;
        }
        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: #212121;
            display: flex;
            align-items: center;
            padding: 0 16px;
            z-index: 1000;
            border-bottom: 1px solid #303030;
        }
        .logo {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: #f00;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        /* „Çµ„Ç§„Éâ„Éê„Éº */
        .sidebar {
            position: fixed;
            top: 56px;
            left: 0;
            width: 240px;
            height: calc(100vh - 56px);
            background: #212121;
            overflow-y: auto;
            border-right: 1px solid #303030;
            z-index: 900;
        }
        .sidebar-section {
            padding: 12px 0;
            border-bottom: 1px solid #303030;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 10px 24px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            color: #fff;
        }
        .sidebar-item:hover {
            background: #3a3a3a;
        }
        .sidebar-item.active {
            background: #3a3a3a;
            font-weight: 500;
        }
        .sidebar-item-icon {
            width: 24px;
            height: 24px;
            margin-right: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .main {
            margin-left: 240px;
            margin-top: 56px;
            padding: 24px;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            max-width: 1920px;
        }
        .video-card {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .video-card:hover {
            transform: scale(1.02);
        }
        .video-card-thumbnail {
            width: 100%;
            aspect-ratio: 16/9;
            background: #303030;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        .video-card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-card-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .video-card-info {
            padding: 12px 0;
        }
        .video-card-title {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .video-card-channel {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 2px;
        }
        .video-card-meta {
            font-size: 12px;
            color: #aaa;
        }
        /* ÂãïÁîªÂÜçÁîüÁîªÈù¢ */
        .player-container {
            display: none;
            max-width: 1280px;
        }
        .player-container.active {
            display: block;
        }
        .video-player {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }
        .video-js {
            width: 100%;
            height: 100%;
        }
        .video-details {
            padding: 20px 0;
        }
        .video-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        .video-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 16px;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #3a3a3a;
            border: none;
            border-radius: 18px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 16px;
            transition: background 0.2s;
        }
        .back-button:hover {
            background: #4a4a4a;
        }
        .related-videos {
            margin-top: 24px;
        }
        .related-videos h3 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
        }
        .related-video-item {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .related-video-item:hover {
            background: #272727;
        }
        .related-video-thumbnail {
            width: 168px;
            height: 94px;
            background: #303030;
            border-radius: 8px;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }
        .related-video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .related-video-info {
            flex: 1;
        }
        .related-video-title {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .related-video-meta {
            font-size: 12px;
            color: #aaa;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }
        .error {
            text-align: center;
            padding: 40px;
            color: #f00;
        }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.mobile-open { transform: translateX(0); }
            .main { margin-left: 0; }
            .video-grid { grid-template-columns: 1fr; gap: 16px; }
            .related-video-thumbnail { width: 120px; height: 68px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo" onclick="showHome()">
            <div class="logo-icon">‚ñ∂</div>
            <span>ÂãïÁîª„Éó„É¨„Ç§„É§„Éº</span>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-item active" onclick="showHome()">
                <div class="sidebar-item-icon">üè†</div>
                „Éõ„Éº„É†
            </div>
        </div>
        <div class="sidebar-section" id="channelList"></div>
    </div>

    <div class="main">
        <div id="homeView">
            <div class="video-grid" id="videoGrid">
                <div class="loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>
        </div>
        <div id="playerView" class="player-container">
            <button class="back-button" onclick="showHome()">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
            <div class="video-player">
                <video id="videoPlayer" class="video-js vjs-big-play-centered" controls preload="auto"></video>
            </div>
            <div class="video-details">
                <div class="video-title" id="currentVideoTitle"></div>
                <div class="video-meta" id="currentVideoMeta"></div>
            </div>
            <div class="related-videos">
                <h3>Èñ¢ÈÄ£ÂãïÁîª</h3>
                <div id="relatedVideos"></div>
            </div>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        let player;
        let allVideos = [];
        let displayedVideos = [];
        let channels = {};

        function initPlayer() {
            player = videojs('videoPlayer', {
                controls: true,
                autoplay: false,
                preload: 'auto',
                responsive: true
            });
        }

        async function loadChannelList() {
            try {
                // Áõ∏ÂØæ„Éë„Çπ„ÅßË™≠„ÅøËæº„Åø
                const response = await fetch('channels.txt');
                const text = await response.text();
                const channelNames = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
                
                for (const channelName of channelNames) {
                    channels[channelName] = `${channelName}.json`;
                }
                
                renderChannelList();
                loadAllVideos();
            } catch (error) {
                console.error('Error loading channel list:', error);
                document.getElementById('videoGrid').innerHTML = '<div class="error">Ë™≠„ÅøËæº„ÅøÂ§±Êïó</div>';
            }
        }

        function renderChannelList() {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';
            Object.keys(channels).forEach(channelName => {
                const item = document.createElement('div');
                item.className = 'sidebar-item';
                item.innerHTML = `<div class="sidebar-item-icon">#</div>${channelName}`;
                item.onclick = (e) => filterByChannel(channelName, e);
                channelList.appendChild(item);
            });
        }

        async function loadAllVideos() {
            allVideos = [];
            for (const [channelName, jsonPath] of Object.entries(channels)) {
                try {
                    // Áõ∏ÂØæ„Éë„Çπ„ÇíÊòéÁ§∫
                    const response = await fetch(`./${jsonPath}`);
                    const videos = await response.json();
                    videos.forEach(video => {
                        video.channelName = channelName;
                        video.m3u8Url = getM3u8Url(video);
                    });
                    allVideos.push(...videos);
                } catch (error) {
                    console.error(`Error loading ${channelName}:`, error);
                }
            }
            renderVideoGrid(allVideos);
        }

        function getM3u8Url(video) {
            // ÂÖàÈ†≠„ÅÆ / „ÇíÂâäÈô§„Åó„Å¶Áõ∏ÂØæ„Éë„Çπ„Å´Â§âÊõ¥
            if (video.content_code && video.channelName) {
                return `${video.channelName}/${video.content_code}.m3u8`;
            }
            return video.url || video.m3u8 || '';
        }

        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return h > 0 ? `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}` : `${m}:${s.toString().padStart(2, '0')}`;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const diffDays = Math.floor((new Date() - date) / (1000 * 60 * 60 * 24));
            if (diffDays === 0) return '‰ªäÊó•';
            if (diffDays < 7) return `${diffDays}Êó•Ââç`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)}ÈÄ±ÈñìÂâç`;
            return `${Math.floor(diffDays / 30)}„É∂ÊúàÂâç`;
        }

        function formatViews(views) {
            return views ? `${views.toLocaleString()}ÂõûË¶ñËÅ¥` : '0ÂõûË¶ñËÅ¥';
        }

        function renderVideoGrid(videos) {
            const grid = document.getElementById('videoGrid');
            if (!videos || videos.length === 0) {
                grid.innerHTML = '<div class="error">ÂãïÁîª„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                displayedVideos = [];
                return;
            }
            displayedVideos = videos;
            grid.innerHTML = videos.map((video, index) => `
                <div class="video-card" onclick='playVideoFromGrid(${index})'>
                    <div class="video-card-thumbnail">
                        ${video.thumbnail_url ? `<img src="${video.thumbnail_url}">` : ''}
                        <div class="video-card-duration">${formatDuration(video.active_video_filename?.length)}</div>
                    </div>
                    <div class="video-card-info">
                        <div class="video-card-title">${video.title || 'ÁÑ°È°å'}</div>
                        <div class="video-card-channel">${video.channelName}</div>
                        <div class="video-card-meta">${formatViews(video.video_aggregate_info?.total_views)} ‚Ä¢ ${formatDate(video.display_date || video.released_at)}</div>
                    </div>
                </div>
            `).join('');
        }

        function playVideoFromGrid(index) {
            const video = displayedVideos[index];
            showPlayer();
            playVideo(video);
        }

        function playVideo(video) {
            player.src({ src: video.m3u8Url, type: 'application/x-mpegURL' });
            document.getElementById('currentVideoTitle').textContent = video.title || 'ÁÑ°È°å';
            document.getElementById('currentVideoMeta').innerHTML = `<span>${video.channelName}</span><span> ‚Ä¢ </span><span>${formatViews(video.video_aggregate_info?.total_views)}</span><span> ‚Ä¢ </span><span>${formatDate(video.display_date || video.released_at)}</span>`;
            
            const related = allVideos.filter(v => v.channelName === video.channelName && v.content_code !== video.content_code).slice(0, 10);
            renderRelatedVideos(related);
            player.play().catch(e => console.error(e));
        }

        function renderRelatedVideos(videos) {
            const container = document.getElementById('relatedVideos');
            container.innerHTML = videos.map(video => {
                return `
                    <div class="related-video-item" onclick='playVideoDirectly(${JSON.stringify(video).replace(/'/g, "&apos;")})'>
                        <div class="related-video-thumbnail">
                            ${video.thumbnail_url ? `<img src="${video.thumbnail_url}">` : ''}
                        </div>
                        <div class="related-video-info">
                            <div class="related-video-title">${video.title}</div>
                            <div class="related-video-meta">${video.channelName}<br>${formatViews(video.video_aggregate_info?.total_views)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function playVideoDirectly(video) {
            playVideo(video);
            window.scrollTo(0, 0);
        }

        function filterByChannel(channelName, event) {
            const filtered = allVideos.filter(v => v.channelName === channelName);
            renderVideoGrid(filtered);
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            if(event) event.currentTarget.classList.add('active');
        }

        function showHome() {
            document.getElementById('homeView').style.display = 'block';
            document.getElementById('playerView').classList.remove('active');
            renderVideoGrid(allVideos);
            if (player) player.pause();
        }

        function showPlayer() {
            document.getElementById('homeView').style.display = 'none';
            document.getElementById('playerView').classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            initPlayer();
            loadChannelList();
        });
    </script>
</body>
</html>
